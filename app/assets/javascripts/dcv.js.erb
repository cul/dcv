$(function() {
  $('body').on('click', '#list-mode', function() {
      $('#content .col-sm-3').addClass('col-sm-12').addClass('list-view');
      $('#content .col-sm-3 .thumbnail').addClass('col-sm-2');
      $('#content .col-sm-3 .index_title').addClass('col-sm-9');
      $('#grid-mode').removeClass('btn-success').addClass('btn-default');
      $('#content .index-show-fields').removeClass('hidden');
      $(this).addClass('btn-success');
  });
  $('body').on('click', '#grid-mode', function() {
      $('#content .col-sm-3').removeClass('col-sm-12').removeClass('list-view');
      $('#content .col-sm-3 .thumbnail').removeClass('col-sm-2');
      $('#content .col-sm-3 .index_title').removeClass('col-sm-9');
      $('#list-mode').removeClass('btn-success').addClass('btn-default');
      $('#content .index-show-fields').addClass('hidden');
      $(this).addClass('btn-success');
  });
  $('body').on('click', '#unzoom-mode', function(){
     // hide the zooming stuff
      $('div#zoom-gallery').addClass('hidden');

      $('ul#child_items').removeClass('hidden');
      $('#zoom-mode').removeClass('btn-success').addClass('btn-default');
      $(this).addClass('btn-success');
  });
  $('body').on('click', '#zoom-mode', function(){
     // do some stuff with a data url
     if (!$.tileSources){
       $.djUrl = "http://iris.cul.columbia.edu:8888/view/";
       $.ajax({
        dataType: "json",
        url: this.getAttribute('data-url'),
        success: function(data){
          var sources = [];
          var children = data['children'] || [];
          var children_map = {};

          for (var i=0; i<children.length; i++) {
            var child = children[i];
            children_map[child['id']] = child;
          }
          $("a[rel='document-link']").each(function() {
            var child = null;
            var dataId = $(this).attr('data-id');
            for (var i=0; i< children.length; i++) {
              if (children[i]['contentids'].indexOf(dataId) > -1) {
                child = children[i];
                break;
              }
            }
            if (child && child['rft_id']) {
            //sources[sources.length] = new OpenSeadragon.DjTileSource($.djUrl, child['rft_id']);
            sources[sources.length] = new OpenSeadragon.CalculatedDjTileSource($.djUrl, child['rft_id'], child['width'], child['length']);
            }
          });
          $.tileSources = sources;
          $.navImages = {};
          // zoomIn buttons
          zoomIn = ($.navImages['zoomIn'] = {});
          zoomIn['REST'] = '<%= image_path("seadragon/zoomin_rest.png")%>';
          zoomIn['GROUP'] = '<%= image_path("seadragon/zoomin_grouphover.png")%>';
          zoomIn['HOVER'] = '<%= image_path("seadragon/zoomin_hover.png")%>';
          zoomIn['DOWN'] = '<%= image_path("seadragon/zoomin_pressed.png")%>';
          // zoomOut buttons
          zoomOut = ($.navImages['zoomOut'] = {});
          zoomOut['REST'] = '<%= image_path("seadragon/zoomout_rest.png")%>';
          zoomOut['GROUP'] = '<%= image_path("seadragon/zoomout_grouphover.png")%>';
          zoomOut['HOVER'] = '<%= image_path("seadragon/zoomout_hover.png")%>';
          zoomOut['DOWN'] = '<%= image_path("seadragon/zoomout_pressed.png")%>';
          // home buttons
          home = ($.navImages['home'] = {});
          home['REST'] = '<%= image_path("seadragon/home_rest.png")%>';
          home['GROUP'] = '<%= image_path("seadragon/home_grouphover.png")%>';
          home['HOVER'] = '<%= image_path("seadragon/home_hover.png")%>';
          home['DOWN'] = '<%= image_path("seadragon/home_pressed.png")%>';
          // fullpage buttons
          fullpage = ($.navImages['fullpage'] = {});
          fullpage['REST'] = '<%= image_path("seadragon/fullpage_rest.png")%>';
          fullpage['GROUP'] = '<%= image_path("seadragon/fullpage_grouphover.png")%>';
          fullpage['HOVER'] = '<%= image_path("seadragon/fullpage_hover.png")%>';
          fullpage['DOWN'] = '<%= image_path("seadragon/fullpage_pressed.png")%>';
          // previous buttons
          previous = ($.navImages['previous'] = {});
          previous['REST'] = '<%= image_path("seadragon/previous_rest.png")%>';
          previous['GROUP'] = '<%= image_path("seadragon/previous_grouphover.png")%>';
          previous['HOVER'] = '<%= image_path("seadragon/previous_hover.png")%>';
          fullpage['DOWN'] = '<%= image_path("seadragon/previous_pressed.png")%>';
          // next buttons
          next = ($.navImages['next'] = {});
          next['REST'] = '<%= image_path("seadragon/next_rest.png")%>';
          next['GROUP'] = '<%= image_path("seadragon/next_grouphover.png")%>';
          next['HOVER'] = '<%= image_path("seadragon/next_hover.png")%>';
          next['DOWN'] = '<%= image_path("seadragon/next_pressed.png")%>';
          OpenSeadragon({
            id:            "zoom-content",
            prefixUrl:     "",
            toolbar:       "zoom-toolbar",
            springStiffness:        10,
            showReferenceStrip:     true,
            autoHideControls:       false,
            showNavigator:  true,
            navImages: $.navImages,
            tileSources: $.tileSources
          });
        }
      });
    }
    // hide the non-zooming stuff
    $('ul#child_items').addClass('hidden');
    // OSD the zooming div
    $('div#zoom-gallery').removeClass('hidden');
    $('#unzoom-mode').removeClass('btn-success').addClass('btn-default');
    $(this).addClass('btn-success');
  });
  $('a.item-link').colorbox({
    maxHeight:"90%",
    maxWidth:"90%",
    title: function(){
      var otit = $(this).data('original-title');
      return otit;
    },
  });
});

//** CULTNBW START **/
  CULh_colorfg = '#000000'; // topnavbar foreground color. hex value. ex: #002B7F
  CULh_colorbg = '#444444'; // topnavbar background color. hex value. ex: #779BC3
  CULh_nobs = 1; // uncomment to NOT load our bootstrap javascript file and or use your own (v2.3.x required)
//** /CULTNBW END **/
