<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!-- Mobile viewport optimization h5bp.com/ad -->
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
    <!--[if IEMobile]>
      <meta http-equiv="cleartype" content="on">
    <![endif]-->

    <title><%= render_page_title %></title>
    <%= opensearch_description_tag application_name, opensearch_catalog_path(:format => 'xml', :only_path => false) %>
    <%= favicon_link_tag asset_path('favicon.ico') %>

    <script data-turbolinks-eval="false">
      var DCV = {}; // DCV Namespace
    </script>

    <%= stylesheet_link_tag    "dcv" %>
    <%= javascript_include_tag "application" %>
    <%= javascript_include_tag "dcv" %>
    <%= javascript_include_tag "d3" %>
    <%= javascript_include_tag "freelib" %>
    <%= csrf_meta_tags %>
    <%= content_for(:head) %>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  <!-- prototype styles -->
  <style data-turbolinks-eval="false">
    html,body.home {
      height:100%;
      padding-top:0!important;
    }
    a:hover { text-decoration:none; }
    h4.lead { border-bottom:1px solid #888; }
    #topnavbar { background-color:rgba(100,100,100,.4); }
    #topnavbar, #pane-1 .cover, .culpanel, .hide-until-load { display:none; }
    #topnavbar:hover { opacity:1!important; }
    #navholder { position:relative; }
    .bgParallax {
      background-size:cover;
      background-repeat:no-repeat;
      background-position:top center;
      background-attachment:fixed;
      display:table;
      margin:0 auto;
      width:100%;
      height:100%;
    }
    #discover {
      background-color: #111;
      background-image:url(<%= image_path('dcv/ldpd.treasures.243.jpg')%>);
      background-position:center center;
    }
    #explore {
      background-image:url(<%= image_path('dcv/rbml_0819r.jpg')%>);
    }
    #about {
      background-image:url(<%= image_path('dcv/rbml_css_0912r.png')%>);
    }
    #home { 
      background-image:url(<%= image_path('dcv/1836760843_267e9c947f_o-sepc.jpg')%>);
    }
    #home a { color:#ddd; }
    .culinner {
      display:table-cell;
      vertical-align:middle;
      text-align:center;
    }
    .culcontainer {
      position:relative;
      max-width:800px;
      margin:0 auto;
    }
    .culpanel {
      width:1190px;
      min-height:340px;
      vertical-align:middle;
      background-color:rgba(0,0,0,.5);
      padding:20px 40px;
      border:1px dotted #666;
      margin:-100px auto 0 auto;
      /*box-shadow:0 0 86px rgba(255,255,255,.4);*/
    }
    #about .culpanel {
      padding:50px 220px;
    } 
    #home .culpanel {
      width:768px;
      padding:20px;
      border:0;
    }
    #menuholder { 
      font-size:85%;
    }
    @media (min-width: 768px) {
      .culpanel { width:740px; }
    }
    @media (min-width: 992px) {
      .culpanel { width:970px; }
    }
    @media (min-width: 1200px) {
      .culpanel { width:1190px; }
    }
    .blurb {
      font-size:.9em;
      text-transform:uppercase;
      font-weight:200;
      margin: 2em 0 0;
    }
    .aligncenter { text-align:center; }
    .alignleft { text-align:left; }
    .alignjustify { text-align:justify; }
    .trajanpro { font-family: "trajan pro", trajan, serif; }
    .bgParallax {
		margin: 0 auto;
        padding-top:60px;
		width: 100%;
		min-height: 100%;
		text-shadow:0 0 10px rgba(0,0,0,0.7);
		background-position: 50% 0;
		background-repeat: no-repeat;
        background-size:cover;
		background-attachment: fixed;
    }
  a.browse-link {
    font-size: 70%;
    color: white;
    text-transform: uppercase;
  }  
  .updown {
    display:none!important;
    position:fixed;
    z-index:15;
    bottom:30px;
    right:20px;
    font-size:1.1em;
    text-align:center;
    opacity:.5;
  }
  #spinner {
    position:fixed;
    top:46%;
    left:48%;
    font-size: 14px;
    text-transform:uppercase;
  }
  .icon-spin {
    display:block;
    margin-bottom:8px;
    font-size: 28px;
    color:#eee;
	-moz-animation: spin 2s infinite linear;
	-o-animation: spin 2s infinite linear;
	-webkit-animation: spin 2s infinite linear;
	animation: spin 2s infinite linear;
  }
	@-moz-keyframes spin {
		from { -moz-transform: rotate(0deg); }
		to { -moz-transform: rotate(360deg); }
	}
	@-webkit-keyframes spin {
		from { -webkit-transform: rotate(0deg); }
		to { -webkit-transform: rotate(360deg); }
	}
	@keyframes spin {
		from {transform:rotate(0deg);}
		to {transform:rotate(360deg);}
	}

  /* D3 Styles */
  text {
  font-size: 66%;
  pointer-events: none;
}

text.parent {
  fill: #333;
}

circle {
  fill: #ccc;
  stroke: #999;
  pointer-events: all;
}

circle.parent {
  fill: #666;
  fill-opacity: .2;
  stroke: #999;
}

circle.parent:hover {
  stroke: #ff7f0e;
  stroke-width: .5px;
}

circle.child {
  /** need to be able to zoom to a child **/
  /** pointer-events: none; **/
}

.brick {
    overflow: hidden;
    border: thin solid black;
    padding: 0;
  }
    img.img-responsive {
      width: 100%;
      opacity: .8;
  }
  img.img-responsive:hover {
    opacity: 1;
  }

  </style>
  <!-- end prototype styles -->

  </head>
  <body class="<%= render_body_class %> dcv <%= params[:action] %>" data-no-turbolink>
    <%= render :partial => 'shared/topnavbar' %>

    <div id="spinner" style="text-align:center;"><i class="glyphicon glyphicon-refresh icon-spin icon-large"></i>Loading</div>

    <div id="home" class="section bgParallax" data-speed="2">
    <div class="updown hide-until-load">
           <a data-id="prev" href="#"><i class="glyphicon glyphicon-arrow-up"></i></a><br>
           <a data-id="next" href="#"><i class="glyphicon glyphicon-arrow-down"></i></a>
    </div>
	<div class="hide-until-load" style="position:absolute;bottom:30px;left:2px;z-index:15;">
		 <ul class="bgslider-captions list-unstyled" style="font-size:110%;text-align:left;z-index:15;margin-bottom:10px;color:rgba(255,255,255,.6);">
		   <li>Title: <a href="#">Amazing Image Title</a></li>
		   <li>Location: <a href="#">Rare Book &amp; Manuscript Library</a></li>
		 </ul>
	</div>
     <div class="culinner">
		<%= yield %>
     </div>
     <ol class="carousel-indicators hide-until-load">
       <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
       <li data-target="#carousel-example-generic" data-slide-to="1"></li>
       <li data-target="#carousel-example-generic" data-slide-to="2"></li>
       <li data-target="#carousel-example-generic" data-slide-to="3"></li>
     </ol>
	  <div class="carousel-controls">
		  <a class="left carousel-control" href="#prev" role="button" data-slide="prev">
			<span class="glyphicon glyphicon-chevron-left hide"></span>
		  </a>
		  <a class="right carousel-control" href="#next" role="button" data-slide="next">
			<span class="glyphicon glyphicon-chevron-right hide"></span>
		  </a>
	  </div>
    </div>

<div id="discover" class="section bgParallax" data-speed="3">
  <div class="culinner container" style="padding-top:60px;">
    <div class="culpanel alignleft row">
     <h4 class="lead">DISCOVER PROJECTS <%= link_to 'Browse projects &raquo;'.html_safe, browse_url(list:'projects'), class: 'browse-link pull-right' %></h4>
        <div id="project-info" class="col-sm-12" style="padding:0;">
          <div style="height:150px;margin-bottom:5px;">
            <div class="row">
              <div class="col-sm-2">
                <div data-style="border:1px solid #888;" style="padding:2px;background-color:#1d1d1d;background-position:center center;background-repeat:no-repeat;background-size:100%;background-image:url('<%= asset_url("digital_projects_page/chinese_paper_gods.png")%>');height:150px;width:100%;" id="burrito">
                  <!--img data-id="burrito" style="max-width:100%; padding:0; max-height:100%;" src="<%=  asset_url("digital_projects_page/chinese_paper_gods.png")%>" /-->
                </div>
              </div>
              <div class="col-sm-10">
               <div style="">
                <h4 class="">Chinese Paper Gods</h4>
                <p class="lead">An online visual catalog of over 200 woodcuts used in folk religious practices in Beijing and other parts of China in the 1930s.</p>
                <p><a href="/catalog?f%5Blib_project_sim%5D%5B%5D=Chinese+paper+gods">View Content &raquo;</a></p>
               </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-12" id="discover-content" data-style="max-height:520px;overflow-y:auto;" style="padding:0;position:relative;">
          <%# @per_row = 2 %>
          <%#= render template: 'pages/digital_projects', :locals => { :per_row => 2 } -%>
        </div>
    </div>
  </div>
</div>

<div id="explore" class="section bgParallax" data-speed="6">
  <div class="culinner">
    <div class="culpanel">
        <h4 class="lead alignleft">EXPLORE FORMATS        <%= link_to 'Browse formats &raquo;'.html_safe, browse_url(list:'lib_format_sim'), class: 'browse-link pull-right' %>
</h4>
        <div class="alignjustify" id="bubbles" style="width:100%">
<h5 class="zoom-label">Flare code size circle packing</h5>
        </div>
    </div>
  </div>
</div>

<div id="about" class="section bgParallax" data-speed="4">
  <div class="culinner">
    <div class="culpanel">
        <h4 class="lead alignleft">ABOUT DIGITAL LIBRARY COLLECTIONS</h4>
        <div class="lead alignjustify">
        Digital Library Collections is a gateway to many of the digital projects that <a href="http://library.columbia.edu">Columbia University Libraries / Information Services</a> has completed over the past ten years. It includes scans of photographs, posters, objects, manuscripts and other archival material from our special and archival collections. The site will continue to grow as more of our special collections are digitized and cataloged. (It does not at present include digitized books, however; these can be located by searching the CLIO catalog.) All site content is intended to be used for education and research.
        </div>
    </div>
  </div>
</div>

<ul class="hide">
	<li id="culnavitems" class="dropdown menu pull-left"><a class="dropdown-toggle menu" data-toggle="dropdown" href="#">DLC <b class="caret"></b></a>
		<ul class="dropdown-menu menu-dropdown dropdown-menu-right">
			<li><a href="#home" class="scrollto">Search</a></li>
			<li><a href="#discover" class="scrollto">Discover</a></li>
			<li><a href="#explore" class="scrollto">Explore</a></li>
			<li><a href="#about" class="scrollto">About</a></li>
		</ul>
	</li>
</ul>


<script data-turbolinks-eval="false">
$(window).load(function() {
  $('#spinner').remove();
  $('#culnavitems').hide().prependTo($('#cul_top-right'));
  $(window).scroll(function(){
    if($(this).scrollTop()>=$('#home').height()/1.6){
       $('#topnavbar').css('opacity','1');
        $('#cul_top-right > li:not(:last-child)').show();
        $('#menuholder li:not(:last-child)').show();
    } else {
       $('#topnavbar').css('opacity','0.3');
        $('#cul_top-right > li:not(:last-child)').hide();
        $('#menuholder li:not(:last-child)').show();
    }
  });
  $('#topnavbar, #pane-1 .cover, .culpanel, .hide-until-load').fadeIn(900);

  if($(window).scrollTop()<$('#home').height()/1.6) {
    $('#topnavbar').fadeTo('slow','0.3');
  }
  var wtop = $('#topnavbar').height();
  if($(this).scrollTop()>=wtop){
      $('#cul_top-right > li:not(:last-child)').show();
      $('#menuholder li:not(:last-child)').show();
  } 

  new DCV.Bubbles("div#bubbles").chart("<%= flare_data_url(format: 'json', fields: 'lib_format_sim,lib_repo_ssim,lib_collection_sim')%>");

});

$(document).ready(function() {

  /* home bg carousel */
  var $bgimgs = [
    "<%= image_path('dcv/1836760843_267e9c947f_o.jpg')%>",
    "<%= image_path('dcv/columbia_university_library___night_by_never4getthis-d57w6dl-cropped.jpg')%>",
    "<%= image_path('dcv/1836760843_267e9c947f_o-sepc.jpg')%>", 
    "<%= image_path('dcv/ldpd-112745.jpg')%>"
  ]; 
  $("#home").bgswitcher({ 
	images: $bgimgs,
    start: false,
	loop: true,
    effect: "fade"
  });
  $('.bgswitcher').addClass('bgParallax').attr('data-speed','2');
  $("#home .carousel-indicators li").on("click", function() {
    $(this).parent().find('.active').removeClass('active')
    $('#home').bgswitcher("select", $(this).index());
    $(this).addClass('active');
  });
  $("#home .carousel-control").on("click", function() {
    var nextprev = $(this).attr('data-slide');
    $('#home').bgswitcher(nextprev);
    if (nextprev == 'next') {
     var $next = $('#home .carousel-indicators li').parent().find('.active').removeClass('active').next();
     if ($next.length) {
       $next.addClass('active');
     } else {
       $('#home .carousel-indicators li:first').addClass('active');
     }
    } else {
     var $prev = $('#home .carousel-indicators li').parent().find('.active').removeClass('active').prev();
     if ($prev.length) {
       $prev.addClass('active');
     } else {
       $('#home .carousel-indicators li:last').addClass('active');
     }
    }
    return false;
  });
  /* /END home bg carousel */

  parallasse();

  $('body').on('click', '.scrollto', function() {
  var where = $(this).attr('href');
    $('body,html').animate({ scrollTop: $(where).offset().top /*- $('#topnavbar').height()*/ }, 900, 'swing');
    $('#culnavitems').removeClass('open');
    return false;
  });
  $('.updown').on('click', 'a', function(e) {
      var t = $(this).attr('data-id'),
      $par = $(this).parent().parent('.section');

    if (t === 'next' && $par.next('div.section').length > 0) {
        var $next = $par.next('.section');
        var top = $next.offset().top;
        
        $('body').animate({
          scrollTop: top     
        }, function () {
        });
    } else if (t === 'prev' && $par.prev('div.section').length > 0) {
        var $prev = $par.prev('.section');
        var top = $prev.offset().top;
        
        $('body').animate({
          scrollTop: top     
        }, function () {
        });
    } 
    return false;
  });

  mosaicDemo('#discover-content');
});

$('div.bgParallax-OFF').each(function(){
	var $obj = $(this);
	$(window).scroll(function() {
		var yPos = -($(window).scrollTop() / $obj.data('speed')); 
		var bgpos = '50% '+ yPos + 'px';
		$obj.css('background-position', bgpos );
	}); 
});


function parallasse() {
		var $window = $(window);
		//$('section[data-type="background"]').each(function() {
		$('.bgParallax').each(function() {
			//$(this).css('background-attachment', 'fixed').css('background-position', '50% -800px');
			var $bgobj = $(this); // assigning the object
			$(window).scroll(function() {
				// Scroll the background at var speed
				// the yPos is a negative value because we're scrolling it UP!
				var yPos = -(($window.scrollTop() - $bgobj.offset().top) / $bgobj.data('speed'));
				var coords = '50% ' + yPos.toFixed(0) + 'px';
				// Move the background
				$bgobj.css({
					backgroundPosition: coords
				});
			});
		});
//		document.createElement("article");
//		document.createElement("section");
}

</script>

  </body>
</html>
