<h1>Editing <%= @subsite.slug %> (<%= link_to("view", site_path(slug: @subsite.slug)) %>)</h1>
<div class="container"><%= form_for @subsite, url: { action: "update",  }, html: { } do |site_form| %>
  <div class="panel panel-primary">
    <div class="panel-heading"><h2 class="panel-title">Site Properties</h2></div>
    <div class="panel-body site_properties">
      <div class="form-group">
        <label for="site_title">Title <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-title"></span></label>
        <%= site_form.text_field :title, class: ['form-control', 'disabled'], disabled: true %>
      </div>
      <div class="form-group">
        <label for="site_title">Alternative Title <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-subtitle"></span></label>
        <%= site_form.text_field :alternative_title, class: ['form-control'], placeholder: (t("cul.archives.physical_location.#{@subsite.repository_id}") if @subsite.repository_id) %>
      </div>
      <div class="form-group">
        <label for="site_palette">Site Palette <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-palette"></span></label>
        <%= site_form.select(:palette, options_for_select([['DLC Default', 'default'], ['Dark', 'monochromeDark'], ['Light', 'monochromeLight'], ['Blue', 'blue']], @subsite.palette), {class: ['form-control']}) %>
      </div>
      <div class="form-group">
        <label for="site_layout">Site Layout <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-layout"></span></label>
        <%= site_form.select(:layout, options_for_select([['DLC Default', 'default'], ['Portrait', 'portrait'], ['Gallery', 'gallery'], ['Signature', 'signature']], @subsite.layout), {class: ['form-control']}) %>
      </div>
      <div class="form-group">
        <label for="site_search_type">Search Type <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-search-type"></span></label>
        <%= site_form.select(:search_type, options_for_select(Site::VALID_SEARCH_TYPES.map {|v| [v.titlecase, v]}, @subsite.search_type), {class: ['form-control']}) %>
      </div>
      <div class="form-group">
        <label for="site[show_facets]">Show Home Page Facets <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-homepage-facets"></span></label>
        <div class="radio">
          <label>
            <%= site_form.radio_button :show_facets, true %>Show facet panel on home page
          </label>
        </div>
        <div class="radio">
          <label>
            <%= site_form.radio_button :show_facets, false %>No home page facet panel
          </label>
        </div>
      </div>
    </div>
  </div>
  <div class="panel panel-primary">
    <div class="panel-heading"><h2 class="panel-title">Site Homepage Images</h2></div>
    <div class="panel-body site_homepage_images">
      <div class="form-group panel panel-info" id="portrait_images">
        <div class="panel-heading form-inline">
          <div class="form-group">
            <label for="site_image_uris">Portrait Layout Images <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-images-portrait"></span></label>
            <button type="button" class="btn btn-primary collapse-toggle<%= ' collapsed' unless @subsite.layout == Site::LAYOUT_PORTRAIT %>" data-toggle="collapse" data-target="#portrait_image_pids" aria-expanded="false" aria-controls="portrait_image_pids" data-parent="site_homepage_images">Image PIDs</button>
          </div>
        </div>
        <div class="panel-body collapse<%= ' in' if @subsite.layout == Site::LAYOUT_PORTRAIT %>" id="portrait_image_pids">
          <%- site_form.object.image_uris.each_with_index do |image_uri, ix| %>
            <fieldset name="site_image_uris" class="paneled">
                <%= site_form.text_field :image_uris, multiple: true, value: image_uri, id: "site_image_uris[#{ix}]" %>
                <%- if ix > 0 %>
                  <button class="btn btn-danger" type="button" onclick="this.parentElement.remove();">
                    <span class="glyphicon glyphicon-remove"></span> Remove
                  </button>
                <%- end %>
            </fieldset>
          <%- end %>
          <fieldset id="add_site_image_uri" style="border-width: 0;">
            <button class="btn btn-info" type="button" onclick="addSiteImageUriFieldSet(this.parentElement);">
              <span class="glyphicon glyphicon-plus"></span> Add a PID
            </button>
          </fieldset>
        </div>
      </div>
      <div class="form-group panel panel-info" id="signature_images">
        <div class="panel-heading form-inline">
          <div class="form-group">
            <label for="site_signature_images">Signature Layout Images <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-images-signature"></span></label>
            <button type="button" class="btn btn-primary collapse-toggle<%= ' collapsed' unless @subsite.layout == Site::LAYOUT_SIGNATURE %>" data-toggle="collapse" data-target="#signature_image_assets" aria-expanded="false" aria-controls="signature_image_assets" data-parent="site_homepage_images">Image Information</button>
          </div>
        </div>
        <div class="panel-body collapse<%= ' in' if @subsite.layout == Site::LAYOUT_SIGNATURE %>" id="signature_image_assets">
          <fieldset class="paneled">
            <div class="col-md-6">
              <label for="site_banner">Signature Banner Image&nbsp;</label><span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-images-signature-banner"></span>
              <%= site_form.file_field :banner %>
            </div>
            <div class="col-md-6">
              <%= render partial: "edit/signature_image_preview" %>
            </div>
          </fieldset>
          <fieldset class="paneled">
            <div class="col-md-6">
              <label for="site_watermark">Signature/Watermark Image&nbsp;</label><span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-images-signature-watermark"></span>
              <%= site_form.file_field :watermark %>
            </div>
            <div class="col-md-6">
              <div class="well banner image-preview palette-<%= @subsite.palette %><%= ' default' unless @subsite.has_watermark_image?%>" style="background-image: url('<%= signature_image_path %>');">
                <%- if @subsite.has_watermark_image? %>
                  <div class="overlay download">
                    <a href="<%= signature_image_path %>" download="<%= "#{@subsite.slug}-#{File.basename(signature_image_path)}"%>">Download Current Watermark Image</a>
                  </div>
                <%- else %>
                  <div class="overlay">DEFAULT IMAGE</div>
                <%- end %>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  </div>
  <div class="panel panel-primary">
    <div class="panel-heading"><h2 class="panel-title">Site Editors</h2></div>
    <div class="panel-body site_editors">
      <div class="form-group">
        <label for="site_editor_uids">Site Editor UNIs</label>
        <p>DLC admins: Enter the comma-separated UNIs of CUL employees authorized to edit this site.</p>
        <%= site_form.text_area(:editor_uids, {value: @subsite.editor_uids.join(",\n"), class: ['form-control'], disabled: !can?(:admin, @subsite)}) %>
      </div>
    </div>
  </div>
  <div class="panel panel-primary">
    <div class="panel-heading"><h2 class="panel-title">Site Pages</h2></div>
    <div class="panel-body site_pages">
      <table class="container">
        <tbody>
      <%- @subsite.site_pages.each do |page| -%>
        <tr class="row">
          <td class="col-md-3"><%= page.slug %></td>
          <td class="col-md-5"><%= page.title %></td>
          <td class="col-md-2"><%= link_to(edit_site_page_path(site_slug: @subsite.slug, slug: page.slug), class: ['btn', 'btn-primary']) do %>
                <span class="glyphicon glyphicon-pencil"></span> Edit
            <% end %>
          </td>
          <td class="col-md-2">
            <%- unless page.slug == 'home' %>
              <%= link_to(site_page_path(site_slug: @subsite.slug, slug: page.slug), method: :delete, data: {confirm: "Are you sure you want to delete page and content at #{page.slug}? It cannot be undone."}, class: ['btn btn-danger']) do  %>
                <span class="glyphicon glyphicon-remove"></span> Delete
                <% end %>
            <%- end %>
          </td>
        </tr>
      <%- end -%>
        </tbody>
        <tfoot class="row">
          <tr class="row">
            <td>
            <%= link_to(new_site_page_path(site_slug: @subsite.slug), class: ['btn btn-info']) do %>
              <span class="glyphicon glyphicon-plus"></span> Add Page
            <% end %>
          </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <div class="panel panel-primary">
    <div class="panel-heading"><h2 class="panel-title">Site Navigation</h2></div>
    <div class="panel-body site_navigation">
      <%= site_form.fields_for :nav_menus do |menu_form| %>
        <div class="panel panel-info site_navigation_menu" id="site_navigation_menu_<%= menu_form.index %>">
          <div class="panel-heading form-inline">
            <div class="form-group">
              <span class="glyphicon glyphicon-move site_navigation_menu_handle"></span>
              <label for="site[nav_menus_attributes][<%= menu_form.index %>][label]">Group Label <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-menu-label"></span></label>
              <%= menu_form.text_field :label, class: ['form-control'] %>
              <button type="button" class="btn btn-primary collapse-toggle collapsed" data-toggle="collapse" data-target="#site_navigation_links_<%= menu_form.index %>" aria-expanded="false" aria-controls="site_navigation_links_<%= menu_form.index %>" data-parent="site_navigation_menu_<%= menu_form.index %>">Links</button>
            </div>
            <div class="pull-right">
              <button type="button" class="btn btn-danger remove" onclick="removeNavMenu(this);"><span class="glyphicon glyphicon-remove"></span> Remove</button>
            </div>
          </div>
          <div class="panel-body collapse site_navigation_links" id="site_navigation_links_<%= menu_form.index %>">
            <%= menu_form.fields_for :links, include_id: false do |link_form| %>
              <div class="panel panel-default site_navigation_link">
                <div class="panel-heading form-horizontal">
                  <div class="form-group">
                    <label class="control-label col-md-2" for="site[nav_menus_attributes][<%= menu_form.index %>][links_attributes][<%= link_form.index %>][label]"><span class="glyphicon glyphicon-move site_navigation_link_handle pull-left"></span> Link Label <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-link-label"></span></label>
                    <div class="col-md-8">
                      <%= link_form.text_field :label, class: ['form-control'] %>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn btn-danger remove" onclick="removeNavLink(this);"  id="menu-<%= menu_form.index %>-remove-link-<%= link_form.index %>"><span class="glyphicon glyphicon-remove"></span> Remove</button>
                    </div>
                  </div>
                </div>
                <div class="panel-body">
                  <div class="form-group">
                    <label for="site[nav_menus_attributes][<%= menu_form.index %>][links_attributes][<%= link_form.index %>][link]">Links To <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-link"></span></label>
                    <%= link_form.text_field :link, class: ['form-control'] %>
                  </div>
                  <div class="form-group">
                    <label for="site[nav_menus_attributes][<%= menu_form.index %>][links_attributes][<%= link_form.index %>][external]">Link Type</label>
                    <div class="radio">
                      <label>
                        <%= link_form.radio_button :external, true %>Links to a full or relative url
                      </label>
                    </div>
                    <div class="radio">
                      <label>
                        <%= link_form.radio_button :external, false %>Links to an in-site page by slug
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            <%- end %>
            <button type="button" onclick="addNavLink(this);" class="btn btn-info" id="menu-<%= menu_form.index %>-add-link">
              <span class="glyphicon glyphicon-plus"></span> Add Link
            </button>
          </div>
        </div>
      <%- end %>
      <button type="button" onclick="addNavMenu(this);" value="Add Navigation Menu" class="btn btn-info" >
        <span class="glyphicon glyphicon-plus"></span> Add Navigation Group
      </button>
    </div>
  </div>
  <div class="panel">
    <%= submit_tag "Update Site Information", {class: ['btn', 'btn-default']} %>
  </div>
<% end %>
<div class="hidden tooltips">
  <span id="tooltip-title" title="Site Title">The title of the site. This is data published from Hyacinth and should not be edited here.</span>
  <span id="tooltip-subtitle" title="Alternative Title">The subtitle of the site. If blank and the Hyacinth data for the site includes a Library Location, that library's name will be used in some layouts.</span>
  <span id="tooltip-nav-menu-label" title="Link Group Label">The label for this group of links, which will be presented as a drop-down menu if there are multiple links. If the group has only one link, the group label will not be displayed and the link will be presented directly in the site navigation bar.</span>
  <span id="tooltip-nav-link-label" title="Link Label">The label used for a link in a drop-down menu or, if it is the only link in a group, the site navigation bar.</span>
  <span id="tooltip-nav-link" title="Link To">The URL associated with this link. Full URLs will indicate that they are links to external resources. If a page slug is given and the link is marked as internal, a link to the named page will be built.</span>
  <span id="tooltip-layout" title="Site Layout">The overall layout of markup for the site, governing the homepage and any configured site pages. "DLC default" defers to the design team's default configurations. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-palette" title="Site Palette">The color scheme for the site, governing the homepage and any configured site pages. "DLC default" defers to the design team's default configurations. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-search-type" title="Search Type">The search type for the site indicates how search results should be presented. "Catalog" indicates that search results should be presented in the context of filters on the general DLC catalog. "Local" indicates that search results should be presented as an isolated corpus, with the configured site layout and palettes. "Custom" indicates that a developer-implemented custom site provides this site's search, and should generally not be selected. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-homepage-facets" title="Show Homepage Facets">Configures the display of a facet panel on the site homepage, if supported by the configured layout. Facets are determined by the general DLC Catalog facets, but limited to facets for which the site's content has two or more values. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-images-portrait" title="Portrait Layout Images">Configures the repository PIDs of images for the site homepage, where supported by the configured layout. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-images-signature" title="Signature Layout Images">Manages the design assets for a site homepage configured with the signature layout. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-images-signature-banner" title="Signature Banner Image">The banner image for a site homepage configured with the signature layout. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
  <span id="tooltip-images-signature-watermark" title="Signature/Watermark Image">The signature/watermark image for a site homepage configured with the signature layout. This is an SVG that is overlaid on the banner image. See the <a href="https://library.columbia.edu/resolve/dlc-editor-docs" target="_blank">site editor documentation</a> for details.</span>
</div>
<div class="hide nav-templates">
    <div class="panel panel-info site_navigation_menu" id="site_navigation_menu_9menuIndex9">
      <div class="panel-heading form-inline">
        <div class="form-group">
          <span class="glyphicon glyphicon-move site_navigation_menu_handle"></span>
          <label for="site[nav_menus_attributes][9menuIndex9][label]">Group Label <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-menu-label"></span></label>
          <input class="form-control" type="text" value="" name="site[nav_menus_attributes][9menuIndex9][label]" id="site_nav_menus_attributes_9menuIndex9_label" />
          <button type="button" class="btn btn-primary collapse-toggle collapsed" data-toggle="collapse" data-target="#site_navigation_links_9menuIndex9" aria-expanded="false" aria-controls="site_navigation_links_9menuIndex9" data-parent="site_navigation_menu_9menuIndex9">Links</button>
        </div>
        <div class="pull-right">
          <button type="button" class="btn btn-danger remove" onclick="removeNavMenu(this);"><span class="glyphicon glyphicon-remove"></span> Remove</button>
        </div>
      </div>
      <div class="panel-body collapse site_navigation_links" id="site_navigation_links_9menuIndex9">
        <input type="button" onclick="addNavLink(this);" value="Add Link" class="btn btn-primary" id="menu-9menuIndex9-add-link"/>
      </div>
    </div>
    <div class="panel panel-default site_navigation_link">
      <div class="panel-heading form-horizontal">
        <div class="form-group">
          <label class="control-label col-md-2" for="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][label]"><span class="glyphicon glyphicon-move site_navigation_link_handle pull-left"></span> Link Label <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-link-label"></span></label>
          <div class="col-md-8">
            <input class="form-control" type="text" value="" name="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][label]" id="site_nav_menus_attributes_9menuIndex9_links_attributes_9linkIndex9_label">
          </div>
          <div class="col-md-2">
            <button type="button" class="btn btn-danger remove" onclick="removeNavLink(this);" id="menu-9menuIndex9-remove-link-9linkIndex9"><span class="glyphicon glyphicon-remove"></span> Remove</button>
          </div>
        </div>
      </div>
      <div class="panel-body">
        <div class="form-group">
          <label for="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][link]">Links To <span class="glyphicon glyphicon-question-sign" data-tooltip="tooltip-nav-link"></span></label>
          <input class="form-control" type="text" value="" name="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][link]" id="site_nav_menus_attributes_9menuIndex9_links_attributes_9linkIndex9_link">
        </div>
        <div class="form-group">
          <label for="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][external]">Link Type</label>
          <div class="radio">
            <label>
              <input type="radio" checked="checked" value="true" name="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][external]" id="site_nav_menus_attributes_9menuIndex9_links_attributes_9linkIndex9_external_true">Links to a full or relative url
            </label>
          </div>
          <div class="radio">
            <label>
              <input type="radio" value="false" name="site[nav_menus_attributes][9menuIndex9][links_attributes][9linkIndex9][external]" id="site_nav_menus_attributes_9menuIndex9_links_attributes_9linkIndex9_external_false">Links to an in-site page by slug
            </label>
          </div>
        </div>
      </div>
</div>
</div>